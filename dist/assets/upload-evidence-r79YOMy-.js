import{a5 as O,r as n,g as V,j as e,H as G,C as z,T as m,B as j,ae as P,S as l,f as g,e as Y}from"./index-cs8KH1Gj.js";import{Q as H,B as v}from"./react-toastify.esm-nWnK002_.js";import{u as W,C as Q,F as q}from"./form-provider-AB30yPNG.js";import{a as y}from"./upload-avatar-ZcmlmDZJ.js";import{F as J}from"./FormControl-aSSJzqHf.js";import{I as K}from"./InputLabel-waUCNIWh.js";import{S as N}from"./Select-xqyf6Rlf.js";import{G as p}from"./Grid-dJ_b6D2D.js";import{C}from"./Card-M8rezznV.js";import"./format-number-DkNQnIoZ.js";import"./fade-YsdWEJJe.js";import"./file-thumbnail-NE2uG7uc.js";import"./index-nuAYcRns.js";import"./image--etRdOrW.js";import"./isMuiElement-MbnxLTZm.js";import"./FormLabel-LFvC5gak.js";import"./index-q81m-9gd.js";import"./Menu-gk9ZpIDp.js";function xe(){const b=O(),[u,_]=n.useState(""),[F,U]=n.useState(""),[a,i]=n.useState([]),S=()=>v.success("Your Document Uploaded"),h=()=>v.error("Failed to Upload"),D=n.useMemo(()=>({doc_type:""}),[]),x=W({defaultValues:D}),{handleSubmit:w,control:R}=x,k=sessionStorage.getItem("vendor");n.useEffect(()=>{U(k||"")},[]);const c=w(async o=>{const t=a.map((s,d)=>{if(s){const r=new FormData;return r.append("doc_type",o.doc_type),r.append("csp_code",F),r.append("file",s),r}return null}).filter(s=>s!==null);try{(await Promise.all(t.map(r=>V.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/upload_document",r,{headers:{"Content-Type":"multipart/form-data"}})))).every(r=>r.data.status==="201")?S():h()}catch(s){console.error("Error submitting form:",s),h()}}),T=[{label:"Milling Unit Photo",key:"milling_unit_photo"},{label:"Milling Unit Video",key:"milling_unit_video"}],E=n.useCallback(o=>t=>{const s=t[0];s&&i(d=>{const r=[...d];return r[o]=Object.assign(s,{preview:URL.createObjectURL(s)}),r})},[]),I=o=>e.jsx(C,{children:e.jsx(l,{spacing:3,sx:{p:3},children:e.jsxs(l,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Upload Your Document"}),e.jsx(y,{accept:{"image/jpeg":[],"image/jpg":[],"image/png":[]},file:a[o],onDrop:E(o),onDelete:()=>i(t=>{const s=[...t];return s[o]=null,s})})]})})},o),L=n.useCallback(o=>{i([...o.map(t=>Object.assign(t,{preview:URL.createObjectURL(t)}))])},[a]),A=o=>{const t=a.filter(s=>s!==o);i(t)},f=()=>{i([])},B=o=>e.jsx(C,{children:e.jsx(l,{spacing:3,sx:{p:3},children:e.jsxs(l,{spacing:1.5,children:[e.jsx(m,{variant:"subtitle2",children:"Upload Your Document"}),e.jsx(y,{accept:{"video/mp4":[],"video/avi":[],"video/mkv":[],"video/mov":[]},multiple:!0,thumbnail:!0,files:a,onDrop:L,onRemove:A,onRemoveAll:f,onUpload:c})]})})},o);function M(){switch(u){case"milling_unit_photo":return e.jsx(e.Fragment,{children:Array.from({length:5}).map((o,t)=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:I(t)},t))});case"milling_unit_video":return Array.from({length:1}).map((o,t)=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:B(t)},t));default:return null}}return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsx("title",{children:" Dashboard | Upload Evidence"})}),e.jsx(H,{}),e.jsxs(z,{maxWidth:b.themeStretch?!1:"xl",children:[e.jsx(m,{variant:"h4",children:"Evidence"}),e.jsx(j,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)"},sx:{mt:"40px"},children:e.jsx(Q,{name:"doc_type",control:R,render:({field:o})=>e.jsxs(J,{fullWidth:!0,children:[e.jsx(K,{children:"Document Type"}),e.jsx(N,{...o,label:"Document Type",onChange:t=>{o.onChange(t),i([]),_(t.target.value)},children:T.map(t=>e.jsx(P,{value:t.key,children:t.label},t.key))})]})})}),e.jsx(j,{sx:{mt:5,width:1,borderRadius:2},children:e.jsxs(q,{methods:x,onSubmit:c,children:[e.jsx(p,{container:!0,spacing:5,children:M()}),u=="milling_unit_photo"&&e.jsxs(l,{direction:"row",justifyContent:"flex-end",spacing:1.5,children:[e.jsx(g,{color:"inherit",variant:"outlined",size:"small",onClick:f,children:"Remove All"}),e.jsx(g,{size:"small",variant:"contained",onClick:c,startIcon:e.jsx(Y,{icon:"eva:cloud-upload-fill"}),children:"Save"})]})]})})]})]})}export{xe as default};
